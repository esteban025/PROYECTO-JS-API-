---
import "../../styles/buttons.css";
import Layout from "@/layouts/Layout.astro";
import ArrowIcon from "@/assets/arrow-down.svg";
import { getCharacterById } from "@/services/getCharacter";

const { id } = Astro.params;
const character = await getCharacterById(id!);
if (!character) {
  return Astro.redirect("/");
}
---

<Layout title={`${character.name} - Personaje | Proyecto JS API Rick y Morty`}>
  <figure
    class="absolute inset-0 w-full h-[50dvh] -z-10"
    style="mask-image: linear-gradient(black 10%, transparent 90%);"
  >
    <img
      src={character.image}
      alt={character.name}
      class="w-full h-full object-cover object-center opacity-20"
      loading="lazy"
    />
  </figure>

  <header
    class="w-full p-2 py-3 max-w-7xl mx-auto relative flex justify-center"
  >
    <h3
      class="text-lg font-semibold mb-2 text-transparent truncate w-max"
      style="background: var(--color-gradient-name-card); -webkit-background-clip: text; background-clip: text;"
      transition:name={`personage-name-${character.id}`}
    >
      {character.name}
    </h3>
  </header>

  <main class="p-4 w-full max-w-3xl mx-auto">
    <section
      class="grid gap-6"
      style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));"
    >
      <figure
        class="rounded-xl overflow-hidden h-full w-full"
        transition:name={`personage-image-${character.id}`}
      >
        <img
          src={character.image}
          alt={character.name}
          class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"
          loading="lazy"
        />
      </figure>

      <div class="info space-y-6">
        <!-- Información General -->
        <div
          class="bg-bg-card rounded-xl p-5 border border-border-card backdrop-blur-md"
        >
          <h4 class="text-xl font-bold mb-4 text-white flex items-center gap-2">
            <svg
              class="w-5 h-5 text-primary"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
              ></path>
            </svg>
            Información General
          </h4>
          <ul class="space-y-3">
            <li class="flex items-start gap-3">
              <span class="text-primary font-semibold min-w-20">Estado:</span>
              <span class="text-text-secondary flex items-center gap-2">
                <span
                  class={`inline-block w-2 h-2 rounded-full ${character.status.toLowerCase() === "alive" ? "bg-green-500" : character.status.toLowerCase() === "dead" ? "bg-red-500" : "bg-gray-500"}`}
                ></span>
                {character.status}
              </span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary font-semibold min-w-20">Especie:</span>
              <span class="text-text-secondary">{character.species}</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary font-semibold min-w-20">Tipo:</span>
              <span class="text-text-secondary">{character.type || "N/A"}</span>
            </li>
            <li class="flex items-start gap-3">
              <span class="text-primary font-semibold min-w-20">Género:</span>
              <span class="text-text-secondary">{character.gender}</span>
            </li>
          </ul>
        </div>

        <!-- Localización -->
        <div
          class="bg-bg-card rounded-xl p-5 border border-border-card backdrop-blur-md"
        >
          <h4 class="text-xl font-bold mb-4 text-white flex items-center gap-2">
            <svg
              class="w-5 h-5 text-primary"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
              ></path>
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            Ubicación
          </h4>
          <ul class="space-y-3">
            <li>
              <span class="text-primary font-semibold block mb-1">Origen:</span>
              <span class="text-text-secondary">{character.origin.name}</span>
            </li>
            <li>
              <span class="text-primary font-semibold block mb-1"
                >Última ubicación conocida:</span
              >
              <span class="text-text-secondary">{character.location.name}</span>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Episodios -->
    <section class="mt-8">
      <div
        class="bg-bg-card rounded-xl p-5 border border-border-card backdrop-blur-md"
      >
        <h4 class="text-xl font-bold mb-4 text-white flex items-center gap-2">
          <svg
            class="w-5 h-5 text-primary"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"
            ></path>
          </svg>
          Episodios
          <span
            class="ml-auto text-sm font-normal text-primary bg-primary/10 px-3 py-1 rounded-full"
          >
            {character.episode.length}
            {character.episode.length === 1 ? "episodio" : "episodios"}
          </span>
        </h4>
        <div
          class="grid gap-2 max-h-[400px] overflow-y-auto pr-2 custom-scrollbar"
        >
          {
            character.episode.map((ep, index) => (
              <div class="flex items-center gap-3 p-3 rounded-lg bg-bg-primary/50 hover:bg-bg-primary/80 transition-colors border border-border-card/30">
                <span class="text-primary font-bold text-sm min-w-[30px]">
                  #{index + 1}
                </span>
                <span class="text-text-secondary text-sm">{ep}</span>
              </div>
            ))
          }
        </div>
      </div>
    </section>

    <!-- Botón de regreso -->
    <div class="mt-8 flex justify-center">
      <a
        href="/"
        class="btn-primary"
        style="background-image: var(--color-gradient-btn); box-shadow: var(--shadow-inset-btn);"
        aria-label="go-back-home"
      >
        <ArrowIcon class="w-4 h-4 block rotate-90" />
        Volver al inicio
      </a>
    </div>
  </main>
  <style>
    h3 {
      font-size: clamp(2rem, 5vw, 4rem);
    }

    .custom-scrollbar::-webkit-scrollbar {
      width: 8px;
    }

    .custom-scrollbar::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: var(--color-primary);
      border-radius: 10px;
    }

    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: var(--color-primary-hover, var(--color-primary));
    }
  </style>
</Layout>
