---
import Arrow from "@assets/arrow-down.svg";
import ButtonPrimary from "./ButtonPrimary.astro";
import "@styles/pagination.css";

interface Props {
  currentPage?: number;
  totalPages?: number[];
}
const { currentPage = 1, totalPages = [] } = Astro.props;
---

<div class="w-full max-w-xl mx-auto p-4 flex justify-center">
  <nav
    class="flex items-center justify-center gap-6"
    aria-label="nav-pagination"
    id="pagination-nav"
  >
    <!-- Botón Anterior -->
    <ButtonPrimary id="prev-btn" aria-label="prev-page" style={"padding:10px"}>
      <div class="block rotate-90">
        <Arrow class="w-4 h-4 block" />
      </div>
    </ButtonPrimary>

    <!-- Números de Página -->
    <div class="pagination-viewport" id="page-numbers">
      <div
        class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-15 aspect-square bg-primary/10 border-2 border-primary/50 rounded-lg pointer-events-none"
      >
      </div>

      <div class="pagination-slider">
        {
          totalPages.map((number) => (
            <span class="page-number-slide" data-current={`num-${number}`}>
              {number}
            </span>
          ))
        }
      </div>
    </div>

    <!-- Botón Siguiente -->
    <ButtonPrimary id="next-btn" aria-label="next-page" style={"padding:10px"}>
      <div class="block -rotate-90">
        <Arrow class="w-4 h-4 block" />
      </div>
    </ButtonPrimary>
  </nav>
</div>

<script is:inline define:vars={{ currentPage, totalPages }}>
  document.addEventListener("astro:page-load", () => {
    const $btnPrev = document.getElementById("prev-btn");
    const $btnNext = document.getElementById("next-btn");
    const $paginationSlider = document.querySelector(".pagination-slider");
    const $paginationViewport = document.querySelector(".pagination-viewport");
    // const $persoagesContainer = document.querySelector(
    //   "section[data-page-number]",
    // );

    const viewportCenter = $paginationViewport.clientWidth / 2; // 85px (centro del viewport)
    const itemWidth = 60; // 50px ancho elemento + 10px gap
    const elementWidth = 50; // ancho solo del elemento
    const elementCenter = elementWidth / 2; // 25px (mitad del elemento)

    let currentPageNumber = currentPage;
    const totalPagesCount = totalPages.length;

    // Función para calcular el offset correcto
    const calculateOffset = (pageNumber) => {
      return viewportCenter - ((pageNumber - 1) * itemWidth + elementCenter);
    };

    // Establecer posición inicial
    $paginationSlider.style.transform = `translateX(${calculateOffset(currentPageNumber)}px)`;

    // Función para marcar el número actual
    const updateCurrentNumber = (pageNumber) => {
      const numbers = $paginationSlider.querySelectorAll("[data-current]");
      numbers.forEach((el) => el.classList.remove("current"));
      numbers[pageNumber - 1].classList.add("current");
    };

    // Función para actualizar el estado de los botones
    const updateButtons = () => {
      // Deshabilitar botón anterior si estamos en la primera página
      if (currentPageNumber === 1) {
        $btnPrev?.setAttribute("disabled", "true");
      } else {
        $btnPrev?.removeAttribute("disabled");
      }

      // Deshabilitar botón siguiente si estamos en la última página
      if (currentPageNumber === totalPagesCount) {
        $btnNext?.setAttribute("disabled", "true");
      } else {
        $btnNext?.removeAttribute("disabled");
      }
    };

    // Inicializar estado
    updateCurrentNumber(currentPageNumber);
    updateButtons();

    $btnPrev?.addEventListener("click", () => {
      if (currentPageNumber > 1) {
        currentPageNumber--;
        const url = new URL(window.location.href);
        url.searchParams.set("page", currentPageNumber.toString());
        window.location.href = url.toString();
      }
    });

    $btnNext?.addEventListener("click", () => {
      if (currentPageNumber < totalPagesCount) {
        currentPageNumber++;
        const url = new URL(window.location.href);
        url.searchParams.set("page", currentPageNumber.toString());
        window.location.href = url.toString();
      }
    });
  });
</script>
